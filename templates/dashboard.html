<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Crypto Arbitrage Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-light">
  <div class="container py-4">
    <h2 class="text-center mb-4">ðŸ“Š Bot Performance</h2>

    <!-- Toggle Buttons -->
    <div class="d-flex justify-content-center mb-4">
      <div class="btn-group">
        <button id="toggleCapital" class="btn btn-outline-primary active">Capital</button>
        <button id="toggleProfit" class="btn btn-outline-success">Profit</button>
        <button id="toggleTrades" class="btn btn-outline-warning">Trade Count</button>
      </div>
    </div>

    <!-- Chart Canvas -->
    <canvas id="performanceChart" height="100"></canvas>
  </div>

  <script>
    let chart;
    let fullData = {};

    async function loadChartData() {
      const res = await fetch('/get_chart_data');
      fullData = await res.json();
      updateChart('capital');
    }

    function updateChart(type) {
      if (chart) chart.destroy();

      let label = '';
      let data = [];
      let color = '#007bff';

      if (type === 'capital') {
        label = 'Capital ($)';
        data = fullData.capital;
        color = '#007bff';
      } else if (type === 'profit') {
        label = 'Profit ($)';
        data = fullData.profit;
        color = '#28a745';
      } else if (type === 'trades') {
        label = 'Trade Count';
        data = fullData.trades;
        color = '#ffc107';
      }

      chart = new Chart(document.getElementById('performanceChart').getContext('2d'), {
        type: 'line',
        data: {
          labels: fullData.timestamps,
          datasets: [{
            label: label,
            data: data,
            fill: false,
            borderColor: color,
            tension: 0.3,
            pointRadius: 3
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { display: true }
          },
          scales: {
            x: { title: { display: true, text: 'Time' }},
            y: { beginAtZero: true }
          }
        }
      });

      // Toggle button style
      ['toggleCapital', 'toggleProfit', 'toggleTrades'].forEach(id => {
        document.getElementById(id).classList.remove('active');
      });
      document.getElementById('toggle' + capitalize(type)).classList.add('active');
    }

    function capitalize(s) {
      return s.charAt(0).toUpperCase() + s.slice(1);
    }

    document.getElementById('toggleCapital').addEventListener('click', () => updateChart('capital'));
    document.getElementById('toggleProfit').addEventListener('click', () => updateChart('profit'));
    document.getElementById('toggleTrades').addEventListener('click', () => updateChart('trades'));

    loadChartData();
  </script>
</body>
</html>
