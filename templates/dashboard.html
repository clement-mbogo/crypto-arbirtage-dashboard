<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Crypto Arbitrage Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .price-card {
            min-width: 200px;
            margin-bottom: 15px;
        }
        .form-control, .form-select {
            max-width: 200px;
        }
    </style>
</head>
<body class="bg-light">
<div class="container py-4">
    <h2 class="mb-4 text-center">üí∞ Crypto Arbitrage Dashboard</h2>

    <!-- Prices -->
    <div class="d-flex flex-wrap justify-content-center gap-3">
        <div class="card price-card border-success">
            <div class="card-body text-center">
                <h5>Bitcoin (BTC)</h5>
                <h6 class="text-success" id="btc-price">Loading...</h6>
            </div>
        </div>
        <div class="card price-card border-primary">
            <div class="card-body text-center">
                <h5>Ethereum (ETH)</h5>
                <h6 class="text-primary" id="eth-price">Loading...</h6>
            </div>
        </div>
    </div>

    <!-- Settings -->
    <div class="card mt-4">
        <div class="card-header bg-secondary text-white">‚öôÔ∏è Bot Settings</div>
        <div class="card-body">
            <form id="settings-form">
                <div class="row g-3">
                    <div class="col-md-3">
                        <label class="form-label">Stake ($)</label>
                        <input type="number" class="form-control" name="stake">
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Target Profit (%)</label>
                        <input type="number" class="form-control" name="target_profit">
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Max Trades</label>
                        <input type="number" class="form-control" name="max_trades">
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Cooldown (seconds)</label>
                        <input type="number" class="form-control" name="cooldown">
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Reinvest</label>
                        <select class="form-select" name="reinvest">
                            <option value="true">Yes</option>
                            <option value="false">No</option>
                        </select>
                    </div>
                </div>
                <div class="mt-3">
                    <button type="submit" class="btn btn-outline-primary">üìÇ Save Settings</button>
                    <button type="button" class="btn btn-outline-success ms-2" id="backtest-btn">üìä Simulate Backtest</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Performance Chart -->
    <div class="card mt-4">
        <div class="card-header">üìà Performance Chart</div>
        <div class="card-body">
            <canvas id="growthChart" height="100"></canvas>
        </div>
    </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const ctx = document.getElementById('growthChart').getContext('2d');
    let growthChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: [],
            datasets: [{
                label: 'Simulated Capital Growth',
                data: [],
                borderColor: 'green',
                fill: false
            }]
        },
        options: { responsive: true }
    });

    async function loadPrices() {
        try {
            const res = await fetch('/prices');
            const data = await res.json();
            document.getElementById('btc-price').textContent = '$' + data.bitcoin;
            document.getElementById('eth-price').textContent = '$' + data.ethereum;
        } catch (err) {
            document.getElementById('btc-price').textContent = 'Error';
            document.getElementById('eth-price').textContent = 'Error';
        }
    }

    async function preloadSettings() {
        const res = await fetch('/settings');
        const settings = await res.json();
        for (const key in settings) {
            const el = document.querySelector(`[name="${key}"]`);
            if (el) el.value = settings[key];
        }
    }

    document.getElementById('settings-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        const formData = new FormData(e.target);
        const data = Object.fromEntries(formData.entries());
        const res = await fetch('/settings', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
        });
        alert('Settings saved');
    });

    document.getElementById('backtest-btn').addEventListener('click', async () => {
        const res = await fetch('/simulate_backtest');
        const result = await res.json();
        growthChart.data.labels = result.timestamps;
        growthChart.data.datasets[0].data = result.capital;
        growthChart.update();
    });

    loadPrices();
    preloadSettings();
    setInterval(loadPrices, 15000);
</script>
</body>
</html>
