<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Crypto Arbitrage Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

  <div class="container mt-4">
    <div class="text-end p-2">
      <strong>Live Prices:</strong>
      <span id="btc-price">BTC: $--</span> |
      <span id="eth-price">ETH: $--</span>
    </div>

    <h2 class="mb-4">Crypto Arbitrage Bot Dashboard</h2>

    <ul class="nav nav-tabs mb-3">
      <li class="nav-item">
        <a class="nav-link active" data-bs-toggle="tab" href="#home">🏠 Home</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" data-bs-toggle="tab" href="#settings">⚙️ Settings</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" data-bs-toggle="tab" href="#trades">📄 Trades</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" id="analytics-tab" data-bs-toggle="tab" href="#analytics">📊 Analytics</a>
      </li>
    </ul>

    <div class="tab-content">
      <div class="tab-pane fade show active" id="home">
        <p>Welcome to the arbitrage dashboard. Bot status, alerts, and graphs will be shown here.</p>
      </div>
      <div class="tab-pane fade" id="settings">
        <p>Settings panel coming soon.</p>
      </div>
      <div class="tab-pane fade" id="trades">
        <p>Trade log will appear here.</p>
      </div>
      <div class="tab-pane fade" id="analytics">
        <div class="p-3">
          <h4>Performance Overview</h4>
          <ul id="analytics-summary" class="list-group mb-3"></ul>

          <h5>Daily Profit (last 7 days)</h5>
          <ul id="daily-profit" class="list-group"></ul>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    function fetchPrices() {
      fetch('/prices')
        .then(response => response.json())
        .then(data => {
          if (data.BTC && data.ETH) {
            document.getElementById('btc-price').textContent = `BTC: $${data.BTC.toLocaleString()}`;
            document.getElementById('eth-price').textContent = `ETH: $${data.ETH.toLocaleString()}`;
          }
        })
        .catch(err => console.error("Price fetch error:", err));
    }

    // Initial fetch and 5-second interval
    fetchPrices();
    setInterval(fetchPrices, 5000);

    // Load analytics on tab click
    document.getElementById('analytics-tab').addEventListener('click', () => {
      fetch('/analytics')
        .then(res => res.json())
        .then(data => {
          const summary = document.getElementById('analytics-summary');
          summary.innerHTML = `
            <li class="list-group-item">Total Trades: ${data.total}</li>
            <li class="list-group-item">Winning Trades: ${data.wins}</li>
            <li class="list-group-item">Losing Trades: ${data.losses}</li>
            <li class="list-group-item">Win Ratio: ${data.win_ratio}</li>
            <li class="list-group-item">Average Profit: $${data.avg_profit}</li>
            <li class="list-group-item">Total Profit: $${data.total_profit}</li>
            <li class="list-group-item">Best Trade: $${data.best_trade}</li>
            <li class="list-group-item">Worst Trade: $${data.worst_trade}</li>
          `;

          const daily = document.getElementById('daily-profit');
          daily.innerHTML = "";
          data.daily.forEach(item => {
            daily.innerHTML += `<li class="list-group-item">${item.date}: $${item.profit}</li>`;
          });
        });
    });
  </script>
</body>
</html>
