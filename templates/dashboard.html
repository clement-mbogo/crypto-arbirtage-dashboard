<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ðŸ’° Crypto Arbitrage Dashboard</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            background-color: #f8f9fa;
        }
        .card {
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        .btn-toggle {
            width: 100px;
        }
    </style>
</head>
<body>
<div class="container py-4">
    <h2 class="text-center mb-4">ðŸ’° Crypto Arbitrage Dashboard</h2>

    <!-- Settings -->
    <div class="card mb-4 p-3">
        <form id="settings-form" class="row g-3">
            <div class="col-md-2">
                <label class="form-label">Stake ($)</label>
                <input type="number" class="form-control" name="stake" id="stake" value="{{ settings.stake }}">
            </div>
            <div class="col-md-2">
                <label class="form-label">Target Profit (%)</label>
                <input type="number" class="form-control" name="target_profit" id="target_profit" value="{{ settings.target_profit }}">
            </div>
            <div class="col-md-2">
                <label class="form-label">Max Trades</label>
                <input type="number" class="form-control" name="max_trades" id="max_trades" value="{{ settings.max_trades }}">
            </div>
            <div class="col-md-2">
                <label class="form-label">Cooldown (min)</label>
                <input type="number" class="form-control" name="cooldown" id="cooldown" value="{{ settings.cooldown }}">
            </div>
            <div class="col-md-2">
                <label class="form-label">Reinvest</label><br>
                <input type="checkbox" id="reinvest" name="reinvest" {{ 'checked' if settings.reinvest }}>
            </div>
            <div class="col-md-2 d-flex align-items-end">
                <button type="submit" class="btn btn-success w-100">Save</button>
            </div>
        </form>
    </div>

    <!-- Graph Controls -->
    <div class="row mb-3">
        <div class="col-md-4">
            <select class="form-select" id="chartType">
                <option value="capital">Capital</option>
                <option value="profit">Profit</option>
                <option value="trades">Trade Count</option>
            </select>
        </div>
        <div class="col-md-4">
            <div class="btn-group w-100">
                <button class="btn btn-outline-primary" id="liveBtn">Live</button>
                <button class="btn btn-outline-secondary" id="paperBtn">Paper</button>
            </div>
        </div>
        <div class="col-md-4 text-end">
            <button class="btn btn-outline-warning" id="backtestBtn">Backtest</button>
        </div>
    </div>

    <!-- Chart -->
    <div class="card mb-4">
        <div class="card-body">
            <canvas id="growthChart" height="100"></canvas>
        </div>
    </div>

    <!-- Prices -->
    <div class="row">
        <div class="col-md-6">
            <div class="card text-white bg-dark mb-3">
                <div class="card-header">Bitcoin (BTC)</div>
                <div class="card-body">
                    <h5 class="card-title" id="btcPrice">Loading...</h5>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card text-white bg-dark mb-3">
                <div class="card-header">Ethereum (ETH)</div>
                <div class="card-body">
                    <h5 class="card-title" id="ethPrice">Loading...</h5>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
const ctx = document.getElementById('growthChart').getContext('2d');
let chart = new Chart(ctx, {
    type: 'line',
    data: {
        labels: [],
        datasets: [{
            label: 'Capital Growth',
            data: [],
            fill: true,
            borderColor: 'green',
            backgroundColor: 'rgba(0,255,0,0.1)',
        }]
    }
});

// Load Prices
async function loadPrices() {
    try {
        const res = await fetch('/prices');
        const data = await res.json();
        document.getElementById('btcPrice').textContent = '$' + data.bitcoin;
        document.getElementById('ethPrice').textContent = '$' + data.ethereum;
    } catch (err) {
        document.getElementById('btcPrice').textContent = 'Error';
        document.getElementById('ethPrice').textContent = 'Error';
    }
}

// Auto-refresh prices
setInterval(loadPrices, 60000);
loadPrices();

// Handle settings form
document.getElementById('settings-form').addEventListener('submit', async function (e) {
    e.preventDefault();
    const form = new FormData(this);
    const settings = Object.fromEntries(form.entries());
    settings.reinvest = form.get("reinvest") === "on";
    await fetch("/settings", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(settings)
    });
    alert
