<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Crypto Arbitrage Dashboard</title>
  <script>
    async function runBacktest() {
      const strategy = document.getElementById('strategy').value;
      const steps = document.getElementById('steps').value;
      await fetch(`/start_backtest?strategy=${strategy}&steps=${steps}`);
      getBacktestLogs();
    }

    async function getBacktestLogs() {
      const res = await fetch('/get_backtest_logs');
      const data = await res.json();
      document.getElementById("capital").innerText = `$${data.capital}`;
      document.getElementById("pnl").innerText = `$${data.pnl}`;

      const table = document.getElementById("log-table");
      table.innerHTML = '<tr><th>Time</th><th>BTC</th><th>ETH</th><th>BNB</th><th>SOL</th></tr>';
      for (const row of data.logs) {
        table.innerHTML += `<tr>
          <td>${row.time}</td>
          <td>${row.BTC_Action || '-'}</td>
          <td>${row.ETH_Action || '-'}</td>
          <td>${row.BNB_Action || '-'}</td>
          <td>${row.SOL_Action || '-'}</td>
        </tr>`;
      }

      const summary = ["btc", "eth", "bnb", "sol"];
      for (const coin of summary) {
        const s = data[`${coin}_summary`];
        document.getElementById(`${coin}_stats`).innerText = `${s.trades} Trades | ${s.win_rate}% Win | $${s.total}`;
      }
    }

    async function resetSim() {
      await fetch('/reset');
      getBacktestLogs();
    }

    function saveLog(coin) {
      fetch(`/save_${coin}_log`).then(() => alert(`${coin.toUpperCase()} log saved.`));
    }

    setInterval(getBacktestLogs, 5000);
    window.onload = getBacktestLogs;
  </script>
  <style>
    body { font-family: Arial; padding: 20px; background: #111; color: #eee; }
    button { margin: 5px; padding: 5px 10px; cursor: pointer; }
    table, th, td { border: 1px solid #444; border-collapse: collapse; padding: 4px; }
    #charts iframe { margin: 5px; }
    .section { margin: 20px 0; }
  </style>
</head>
<body>
  <h2>ğŸ“ˆ Crypto Arbitrage Dashboard</h2>

  <div class="section">
    <label>Strategy:</label>
    <select id="strategy">
      <option value="random">Random</option>
      <option value="threshold">Threshold</option>
      <option value="spread">Spread-heavy</option>
    </select>

    <label style="margin-left:20px">Steps:</label>
    <input type="number" id="steps" value="1" min="1" max="200" style="width:50px">
    <button onclick="runBacktest()">â–¶ï¸ Run</button>
    <button onclick="resetSim()">ğŸ” Reset</button>
  </div>

  <div class="section">
    <h3>ğŸ’° Capital: <span id="capital">$0</span> | ğŸ“Š Total PnL: <span id="pnl">$0</span></h3>
    <p id="btc_stats"></p>
    <p id="eth_stats"></p>
    <p id="bnb_stats"></p>
    <p id="sol_stats"></p>
  </div>

  <div class="section">
    <h3>ğŸ“‹ Live Trades</h3>
    <table id="log-table"></table>
  </div>

  <div class="section">
    <h3>ğŸ“¤ Export Logs</h3>
    <button onclick="saveLog('btc')">Save BTC</button>
    <button onclick="saveLog('eth')">Save ETH</button>
    <button onclick="saveLog('bnb')">Save BNB</button>
    <button onclick="saveLog('sol')">Save SOL</button>
  </div>

  <div class="section" id="charts">
    <h3>ğŸ“Š Live Charts</h3>
    <iframe src="https://www.tradingview.com/widgetembed/?symbol=BINANCE:BTCUSDT&interval=30&theme=dark" width="400" height="300"></iframe>
    <iframe src="https://www.tradingview.com/widgetembed/?symbol=BINANCE:ETHUSDT&interval=30&theme=dark" width="400" height="300"></iframe>
    <iframe src="https://www.tradingview.com/widgetembed/?symbol=BINANCE:BNBUSDT&interval=30&theme=dark" width="400" height="300"></iframe>
    <iframe src="https://www.tradingview.com/widgetembed/?symbol=BINANCE:SOLUSDT&interval=30&theme=dark" width="400" height="300"></iframe>
  </div>
</body>
</html>
